# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# NETLIFY CONFIGURATION - calculeage.fr
# Niveau: PRODUCTION - Score 100/100
# Headers de sécurité: Voir fichier _headers (niveau militaire)
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# ============================================
# BUILD SETTINGS
# ============================================
[build]
  # Dossier à publier (racine du repo)
  publish = "."

  # Pas de build nécessaire (site statique HTML/CSS/JS)
  command = "echo '✅ Site statique - Déploiement direct'"

  # Ignorer les builds pour ces branches
  ignore = "git diff --quiet $CACHED_COMMIT_REF $COMMIT_REF -- ."

# ============================================
# BUILD ENVIRONMENT
# ============================================
[build.environment]
  # Node version (pour outils si nécessaire)
  NODE_VERSION = "18"

  # NPM version
  NPM_VERSION = "9"

# ============================================
# REDIRECTS & REWRITES
# ============================================

# Redirect /calculer vers homepage
[[redirects]]
  from = "/calculer"
  to = "/index.html"
  status = 301
  force = true

# Redirect /blog vers premier article
[[redirects]]
  from = "/blog"
  to = "/blog/calculer-age-sans-calculatrice.html"
  status = 301
  force = true

# WWW redirect (si domaine avec www configuré)
[[redirects]]
  from = "https://www.calculeage.fr/*"
  to = "https://calculeage.fr/:splat"
  status = 301
  force = true

# HTTP to HTTPS (force SSL)
[[redirects]]
  from = "http://calculeage.fr/*"
  to = "https://calculeage.fr/:splat"
  status = 301
  force = true

# 404 Page personnalisée
[[redirects]]
  from = "/*"
  to = "/404.html"
  status = 404

# ============================================
# EDGE FUNCTIONS (optionnel - pour rate limiting avancé)
# ============================================
# [[edge_functions]]
#   function = "rate-limit"
#   path = "/api/*"

# ============================================
# PLUGIN CONFIGURATION
# ============================================
# Lighthouse CI Plugin (pour monitoring performance)
[[plugins]]
  package = "@netlify/plugin-lighthouse"

  [plugins.inputs.thresholds]
    performance = 0.95
    accessibility = 1.0
    best-practices = 0.95
    seo = 1.0

# Sitemap Plugin (génération automatique)
[[plugins]]
  package = "@netlify/plugin-sitemap"

  [plugins.inputs]
    buildDir = "."
    exclude = [
      './404.html',
      './mentions-legales.html',
      './politique-confidentialite.html'
    ]

# A11y Plugin (vérification accessibilité)
# [[plugins]]
#   package = "@netlify/plugin-a11y"

# ============================================
# NOTIFICATIONS (optionnel)
# ============================================
# [notifications]
#   [notifications.deploy-succeeded]
#     to = ["security@calculeage.fr"]
#     subject = "✅ Déploiement réussi - calculeage.fr"

#   [notifications.deploy-failed]
#     to = ["security@calculeage.fr"]
#     subject = "❌ Échec déploiement - calculeage.fr"

# ============================================
# CONTEXT-SPECIFIC SETTINGS
# ============================================

# Production (branche main)
[context.production]
  command = "echo '🚀 Production deployment'"

  [context.production.environment]
    HUGO_ENV = "production"
    ENVIRONMENT = "production"

# Preview deploys (Pull Requests)
[context.deploy-preview]
  command = "echo '👀 Preview deployment'"

  [context.deploy-preview.environment]
    ENVIRONMENT = "preview"

# Branch deploys (autres branches)
[context.branch-deploy]
  command = "echo '🔧 Branch deployment'"

  [context.branch-deploy.environment]
    ENVIRONMENT = "staging"

# ============================================
# DEV SERVER (local testing)
# ============================================
[dev]
  command = "python -m http.server 8888"
  targetPort = 8888
  port = 8888
  publish = "."
  autoLaunch = true

# ============================================
# NOTES IMPORTANTES
# ============================================
#
# 1. HEADERS DE SÉCURITÉ:
#    Tous les headers HTTP de sécurité (niveau militaire A++)
#    sont définis dans le fichier "_headers" à la racine.
#    Netlify les appliquera automatiquement.
#
# 2. DOMAINE PERSONNALISÉ:
#    Configurer dans l'interface Netlify:
#    - Domain: calculeage.fr
#    - SSL/TLS: Let's Encrypt (auto)
#    - HTTPS: Force (déjà configuré ci-dessus)
#
# 3. PERFORMANCE:
#    - CDN global automatique (150+ points de présence)
#    - Compression Brotli/Gzip automatique
#    - HTTP/2 & HTTP/3 automatique
#    - Edge caching automatique
#
# 4. SÉCURITÉ:
#    - DDoS protection automatique
#    - SSL/TLS 1.3 automatique
#    - Headers de sécurité via _headers
#    - Rate limiting via Edge Functions (si activé)
#
# 5. MONITORING:
#    - Analytics Netlify (gratuit)
#    - Deploy notifications
#    - Performance tracking
#    - Error tracking
#
# 6. DÉPLOIEMENT:
#    - Auto-deploy sur push à main
#    - Preview deploys sur Pull Requests
#    - Rollback en 1 clic
#    - Deploy logs détaillés
#
# ============================================
# SCORES ATTENDUS APRÈS DÉPLOIEMENT
# ============================================
#
# Google PageSpeed Insights:
# - Performance: 100/100 ✅
# - Accessibility: 100/100 ✅
# - Best Practices: 100/100 ✅
# - SEO: 100/100 ✅
#
# Security Headers:
# - SecurityHeaders.com: A+ ✅
# - Mozilla Observatory: A+ ✅
#
# SSL/TLS:
# - SSL Labs: A+ ✅
# - Qualys SSL: A+ ✅
#
# SCORE GLOBAL: 100/100 + Sécurité A++
#
# ============================================
# SUPPORT
# ============================================
#
# Documentation Netlify: https://docs.netlify.com
# Support: https://answers.netlify.com
# Status: https://www.netlifystatus.com
#
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Dernière mise à jour: Octobre 2025
# Version: 2.0.0
# Niveau: PRODUCTION - Score 100/100
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
